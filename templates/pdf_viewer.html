{% extends "base.html" %}
{% block title %}DocEditor - {{ file.original_name }}{% endblock %}
{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
{% endblock %}
{% block content %}
<div class="row">
    <div class="col-md-9">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <a href="/" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Zurueck</a>
                <strong class="ms-2">{{ file.original_name }}</strong>
            </div>
            <div class="btn-group" id="pdf-toolbar">
                <button class="btn btn-sm btn-outline-primary" id="prev-page"><i class="bi bi-chevron-left"></i></button>
                <span class="btn btn-sm btn-outline-secondary disabled" id="page-info">Seite 1 / ?</span>
                <button class="btn btn-sm btn-outline-primary" id="next-page"><i class="bi bi-chevron-right"></i></button>
                <button class="btn btn-sm btn-outline-warning" id="rotate-page-btn" title="Seite drehen"><i class="bi bi-arrow-clockwise"></i></button>
                <button class="btn btn-sm btn-outline-danger" id="delete-page-btn" title="Seite loeschen"><i class="bi bi-trash"></i></button>
            </div>
        </div>
        <!-- PDF canvas -->
        <div id="pdf-container" style="position:relative; display:inline-block;">
            <canvas id="pdf-canvas"></canvas>
            <canvas id="annotation-canvas" style="position:absolute;top:0;left:0;"></canvas>
        </div>
        <!-- Annotation toolbar -->
        <div class="mt-2 p-2 bg-light rounded" id="annotation-toolbar">
            <strong>Annotieren:</strong>
            <div class="btn-group btn-group-sm ms-2">
                <button class="btn btn-outline-dark active" data-tool="select"><i class="bi bi-cursor"></i></button>
                <button class="btn btn-outline-dark" data-tool="draw"><i class="bi bi-pencil"></i></button>
                <button class="btn btn-outline-dark" data-tool="rect"><i class="bi bi-square"></i></button>
                <button class="btn btn-outline-dark" data-tool="circle"><i class="bi bi-circle"></i></button>
                <button class="btn btn-outline-dark" data-tool="text"><i class="bi bi-fonts"></i></button>
            </div>
            <input type="color" id="anno-color" value="#ff0000" class="ms-2" style="height:30px;">
            <input type="number" id="anno-stroke" value="2" min="1" max="20" style="width:60px" class="form-control form-control-sm d-inline-block ms-2" title="Strichstaerke">
            <button class="btn btn-sm btn-outline-danger ms-2" id="clear-annotations">Loeschen</button>
            <button class="btn btn-sm btn-success ms-2" id="save-annotations">Speichern</button>
            <!-- Text overlay section -->
            <span class="ms-3"><strong>Text-Overlay:</strong></span>
            <input type="text" id="text-overlay-input" class="form-control form-control-sm d-inline-block ms-1" style="width:200px" placeholder="Text eingeben...">
            <input type="number" id="text-overlay-size" value="14" min="6" max="72" class="form-control form-control-sm d-inline-block ms-1" style="width:60px" title="Schriftgroesse">
            <button class="btn btn-sm btn-primary ms-1" id="place-text-overlay">Platzieren</button>
        </div>
    </div>
    <div class="col-md-3">
        <div id="version-panel"></div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<script>const FILE_ID = "{{ file.file_id }}";</script>
<script src="{{ url_for('static', filename='js/pdf_viewer.js') }}"></script>
<script src="{{ url_for('static', filename='js/pdf_annotator.js') }}"></script>
<script src="{{ url_for('static', filename='js/version_panel.js') }}"></script>
{% endblock %}

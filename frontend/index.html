<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DocEditor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#/"><i class="bi bi-file-earmark-richtext"></i> DocEditor</a>
        </div>
    </nav>
    <div class="container-fluid mt-3">

        <!-- === Section: File Browser === -->
        <div id="page-files" class="page-section">
            <div class="row">
                <div class="col-md-8">
                    <h2>Dateien</h2>
                    <div id="file-list" class="list-group mt-3"></div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Datei hochladen</h5>
                            <form id="upload-form">
                                <div class="mb-3">
                                    <input type="file" class="form-control" id="file-input" accept=".pdf,.png,.jpg,.jpeg,.gif,.bmp,.tiff,.webp">
                                </div>
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="bi bi-upload"></i> Hochladen
                                </button>
                            </form>
                            <div id="upload-status" class="mt-2"></div>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">PDF zusammenfuegen</h5>
                            <div id="merge-selection" class="mb-2"></div>
                            <button id="merge-btn" class="btn btn-outline-secondary w-100" disabled>
                                <i class="bi bi-files"></i> Ausgewaehlte PDFs mergen
                            </button>
                        </div>
                    </div>
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title"><i class="bi bi-camera"></i> Foto &rarr; PDF</h5>
                            <div id="photo-pdf-selection" class="mb-2"></div>
                            <div class="mb-2">
                                <small class="text-muted">Bildverbesserung:</small>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="enhance-deskew" checked>
                                    <label class="form-check-label" for="enhance-deskew">Begradigen</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="enhance-sharpen" checked>
                                    <label class="form-check-label" for="enhance-sharpen">Schaerfe</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="enhance-contrast" checked>
                                    <label class="form-check-label" for="enhance-contrast">Kontrast</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" id="enhance-threshold">
                                    <label class="form-check-label" for="enhance-threshold">S/W</label>
                                </div>
                            </div>
                            <button id="photo-pdf-btn" class="btn btn-outline-success w-100" disabled>
                                <i class="bi bi-file-earmark-pdf"></i> Foto &rarr; PDF
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- === Section: PDF Viewer === -->
        <div id="page-pdf" class="page-section" style="display:none;">
            <div class="row">
                <div class="col-md-9">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <a href="#/" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Zurueck</a>
                            <strong class="ms-2" id="pdf-filename"></strong>
                        </div>
                        <div class="btn-group" id="pdf-toolbar">
                            <button class="btn btn-sm btn-outline-primary" id="prev-page"><i class="bi bi-chevron-left"></i></button>
                            <span class="btn btn-sm btn-outline-secondary disabled" id="page-info">Seite 1 / ?</span>
                            <button class="btn btn-sm btn-outline-primary" id="next-page"><i class="bi bi-chevron-right"></i></button>
                            <button class="btn btn-sm btn-outline-warning" id="rotate-page-btn" title="Seite drehen"><i class="bi bi-arrow-clockwise"></i></button>
                            <button class="btn btn-sm btn-outline-danger" id="delete-page-btn" title="Seite loeschen"><i class="bi bi-trash"></i></button>
                        </div>
                    </div>
                    <!-- PDF canvas -->
                    <div id="pdf-container" style="position:relative; display:inline-block;">
                        <canvas id="pdf-canvas"></canvas>
                        <canvas id="annotation-canvas" style="position:absolute;top:0;left:0;"></canvas>
                    </div>
                    <!-- Annotation toolbar -->
                    <div class="mt-2 p-2 bg-light rounded" id="annotation-toolbar">
                        <strong>Annotieren:</strong>
                        <div class="btn-group btn-group-sm ms-2">
                            <button class="btn btn-outline-dark active" data-tool="select"><i class="bi bi-cursor"></i></button>
                            <button class="btn btn-outline-dark" data-tool="draw"><i class="bi bi-pencil"></i></button>
                            <button class="btn btn-outline-dark" data-tool="rect"><i class="bi bi-square"></i></button>
                            <button class="btn btn-outline-dark" data-tool="circle"><i class="bi bi-circle"></i></button>
                            <button class="btn btn-outline-dark" data-tool="text"><i class="bi bi-fonts"></i></button>
                        </div>
                        <input type="color" id="anno-color" value="#ff0000" class="ms-2" style="height:30px;">
                        <input type="number" id="anno-stroke" value="2" min="1" max="20" style="width:60px" class="form-control form-control-sm d-inline-block ms-2" title="Strichstaerke">
                        <button class="btn btn-sm btn-outline-danger ms-2" id="clear-annotations">Loeschen</button>
                        <button class="btn btn-sm btn-success ms-2" id="save-annotations">Speichern</button>
                        <!-- Text overlay section -->
                        <span class="ms-3"><strong>Text-Overlay:</strong></span>
                        <input type="text" id="text-overlay-input" class="form-control form-control-sm d-inline-block ms-1" style="width:200px" placeholder="Text eingeben...">
                        <input type="number" id="text-overlay-size" value="14" min="6" max="72" class="form-control form-control-sm d-inline-block ms-1" style="width:60px" title="Schriftgroesse">
                        <button class="btn btn-sm btn-primary ms-1" id="place-text-overlay">Platzieren</button>
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="version-panel"></div>
                </div>
            </div>
        </div>

        <!-- === Section: Image Editor === -->
        <div id="page-image" class="page-section" style="display:none;">
            <div class="row">
                <div class="col-md-9">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div>
                            <a href="#/" class="btn btn-outline-secondary btn-sm"><i class="bi bi-arrow-left"></i> Zurueck</a>
                            <strong class="ms-2" id="image-filename"></strong>
                        </div>
                    </div>
                    <!-- Image canvas -->
                    <div id="image-container">
                        <canvas id="image-canvas"></canvas>
                    </div>
                    <!-- Toolbar -->
                    <div class="mt-2 p-2 bg-light rounded">
                        <div class="row g-2">
                            <div class="col-auto">
                                <strong>Werkzeuge:</strong>
                                <div class="btn-group btn-group-sm ms-2" id="image-tools">
                                    <button class="btn btn-outline-dark active" data-tool="select"><i class="bi bi-cursor"></i></button>
                                    <button class="btn btn-outline-dark" data-tool="draw"><i class="bi bi-pencil"></i></button>
                                    <button class="btn btn-outline-dark" data-tool="rect"><i class="bi bi-square"></i></button>
                                    <button class="btn btn-outline-dark" data-tool="circle"><i class="bi bi-circle"></i></button>
                                    <button class="btn btn-outline-dark" data-tool="textbox"><i class="bi bi-fonts"></i></button>
                                    <button class="btn btn-outline-dark" data-tool="crop"><i class="bi bi-crop"></i> Zuschnitt</button>
                                </div>
                                <input type="color" id="draw-color" value="#ff0000" class="ms-2" style="height:30px;">
                                <input type="number" id="draw-stroke" value="2" min="1" max="20" style="width:60px" class="form-control form-control-sm d-inline-block ms-1" title="Strichstaerke">
                            </div>
                        </div>
                        <div class="row g-2 mt-1">
                            <div class="col-auto">
                                <strong>Aktionen:</strong>
                                <button class="btn btn-sm btn-outline-primary ms-2" id="rotate-left"><i class="bi bi-arrow-counterclockwise"></i> -90</button>
                                <button class="btn btn-sm btn-outline-primary" id="rotate-right"><i class="bi bi-arrow-clockwise"></i> +90</button>
                                <button class="btn btn-sm btn-outline-secondary ms-2" id="resize-btn"><i class="bi bi-arrows-angle-expand"></i> Groesse aendern</button>
                                <button class="btn btn-sm btn-outline-danger ms-2" id="clear-objects">Zeichnungen loeschen</button>
                            </div>
                        </div>
                        <div class="row g-2 mt-1">
                            <div class="col-auto">
                                <strong>Filter:</strong>
                                <label class="ms-2">Helligkeit: <input type="range" id="brightness" min="0.2" max="3" step="0.1" value="1" class="form-range d-inline-block" style="width:100px;vertical-align:middle;"></label>
                                <label class="ms-2">Kontrast: <input type="range" id="contrast" min="0.2" max="3" step="0.1" value="1" class="form-range d-inline-block" style="width:100px;vertical-align:middle;"></label>
                                <label class="ms-2">Saettigung: <input type="range" id="saturation" min="0.2" max="3" step="0.1" value="1" class="form-range d-inline-block" style="width:100px;vertical-align:middle;"></label>
                                <button class="btn btn-sm btn-outline-info ms-2" id="apply-filters">Anwenden</button>
                            </div>
                        </div>
                        <div class="row g-2 mt-1" id="crop-controls" style="display:none;">
                            <div class="col-auto">
                                <strong>Zuschnitt:</strong>
                                <button class="btn btn-sm btn-success ms-2" id="apply-crop">Zuschnitt anwenden</button>
                                <button class="btn btn-sm btn-outline-secondary" id="cancel-crop">Abbrechen</button>
                            </div>
                        </div>
                        <div class="row g-2 mt-1" id="resize-controls" style="display:none;">
                            <div class="col-auto">
                                <strong>Neue Groesse:</strong>
                                <input type="number" id="resize-w" class="form-control form-control-sm d-inline-block ms-2" style="width:80px" placeholder="Breite">
                                x <input type="number" id="resize-h" class="form-control form-control-sm d-inline-block" style="width:80px" placeholder="Hoehe">
                                <button class="btn btn-sm btn-success ms-2" id="apply-resize">Anwenden</button>
                                <button class="btn btn-sm btn-outline-secondary" id="cancel-resize">Abbrechen</button>
                            </div>
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-success" id="save-image"><i class="bi bi-save"></i> Annotierungen speichern</button>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div id="image-version-panel"></div>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/app.js"></script>
    <script src="/js/file_browser.js"></script>
    <script src="/js/pdf_viewer.js"></script>
    <script src="/js/pdf_annotator.js"></script>
    <script src="/js/image_editor.js"></script>
    <script src="/js/version_panel.js"></script>
</body>
</html>
